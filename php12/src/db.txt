-- Создание базы
CREATE DATABASE IF NOT EXISTS `todolist_db` 
    DEFAULT CHARACTER SET utf8mb4 
    COLLATE utf8mb4_general_ci;
USE `todolist_db`;

-- Таблица ролей
CREATE TABLE `roles` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `roles` VALUES 
(1,'Участник'),
(2,'Модератор'),
(3,'Админ');

-- Таблица уровней срочности
CREATE TABLE `urgency` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) NOT NULL,
  `color` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `urgency` VALUES 
(1,'Срочно','high'),
(2,'Средне','medium'),
(3,'Не важно','low');

-- Пользователи
CREATE TABLE `users` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `email` varchar(45) NOT NULL,
  `passwordHash` varchar(256) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Только админ (без пустых записей)
INSERT INTO `users` (`email`, `passwordHash`) VALUES 
('admin@example.com', '$2y$10$pEBDSxRluIgBLJ5uObjkYO8xDYkbwPxf/QIXMYErVXNponBnehpiC');

-- Связь пользователь-роли
CREATE TABLE `user_roles` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `userId` int(11) NOT NULL,
  `roleId` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `userId` (`userId`),
  KEY `roleId` (`roleId`),
  CONSTRAINT `user_roles_ibfk_1` FOREIGN KEY (`userId`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `user_roles_ibfk_2` FOREIGN KEY (`roleId`) REFERENCES `roles` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `user_roles` (`userId`, `roleId`) VALUES (1, 3);

-- Задачи
CREATE TABLE `tasks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) NOT NULL,
  `due` date DEFAULT NULL,
  `description` text DEFAULT NULL,
  `urgencyId` int(11) DEFAULT 3,
  PRIMARY KEY (`id`),
  KEY `urgencyId` (`urgencyId`),
  CONSTRAINT `tasks_ibfk_1` FOREIGN KEY (`urgencyId`) REFERENCES `urgency` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

